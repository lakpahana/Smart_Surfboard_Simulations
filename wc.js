const guideSim = [
    {
        "timestamp": "2023-08-25T10:06:00Z",
        "gps": {
            "distance_from_beach": "38m",
            "latitude": "6.031978",
            "longitude": "80.237782",
            "speed": "0.25"
        },
        "accelerometer": {
            "x": "0.12",
            "y": "9.79",
            "z": "0.22"
        },
        "gyroscope": {
            "pitch": "0.95",
            "roll": "0.15",
            "yaw": "0.05"
        },
        "force": {
            "front": "24.5",
            "middle": "44.5",
            "rear": "29.5"
        },
        "pressure": "1015.6 hPa",
        "temperature": "19.6°C"
    },
    {
        "timestamp": "2023-08-25T10:07:00Z",
        "gps": {
            "distance_from_beach": "36m",
            "latitude": "6.031914",
            "longitude": "80.237795",
            "speed": "0.27"
        },
        "accelerometer": {
            "x": "0.14",
            "y": "9.78",
            "z": "0.24"
        },
        "gyroscope": {
            "pitch": "0.9",
            "roll": "0.2",
            "yaw": "0.1"
        },
        "force": {
            "front": "24.0",
            "middle": "44.0",
            "rear": "29.0"
        },
        "pressure": "1015.5 hPa",
        "temperature": "19.7°C"
    },
    {
        "timestamp": "2023-08-25T10:08:00Z",
        "gps": {
            "distance_from_beach": "34m",
            "latitude": "6.03185",
            "longitude": "80.237808",
            "speed": "0.29"
        },
        "accelerometer": {
            "x": "0.16",
            "y": "9.77",
            "z": "0.26"
        },
        "gyroscope": {
            "pitch": "0.85",
            "roll": "0.25",
            "yaw": "0.15"
        },
        "force": {
            "front": "23.5",
            "middle": "43.5",
            "rear": "28.5"
        },
        "pressure": "1015.4 hPa",
        "temperature": "19.8°C"
    },
    {
        "timestamp": "2023-08-25T10:09:00Z",
        "gps": {
            "distance_from_beach": "32m",
            "latitude": "6.031786",
            "longitude": "80.237821",
            "speed": "0.31"
        },
        "accelerometer": {
            "x": "0.18",
            "y": "9.76",
            "z": "0.28"
        },
        "gyroscope": {
            "pitch": "0.8",
            "roll": "0.3",
            "yaw": "0.2"
        },
        "force": {
            "front": "23.0",
            "middle": "43.0",
            "rear": "28.0"
        },
        "pressure": "1015.3 hPa",
        "temperature": "19.9°C"
    },
    {
        "timestamp": "2023-08-25T10:10:00Z",
        "gps": {
            "distance_from_beach": "30m",
            "latitude": "6.031722",
            "longitude": "80.237834",
            "speed": "0.33"
        },
        "accelerometer": {
            "x": "0.2",
            "y": "9.75",
            "z": "0.3"
        },
        "gyroscope": {
            "pitch": "0.75",
            "roll": "0.35",
            "yaw": "0.25"
        },
        "force": {
            "front": "22.5",
            "middle": "42.5",
            "rear": "27.5"
        },
        "pressure": "1015.2 hPa",
        "temperature": "20.0°C"
    },
    {
        "timestamp": "2023-08-25T10:11:00Z",
        "gps": {
            "distance_from_beach": "28m",
            "latitude": "6.031658",
            "longitude": "80.237847",
            "speed": "0.34"
        },
        "accelerometer": {
            "x": "0.21",
            "y": "9.74",
            "z": "0.31"
        },
        "gyroscope": {
            "pitch": "0.72",
            "roll": "0.38",
            "yaw": "0.28"
        },
        "force": {
            "front": "22.2",
            "middle": "42.2",
            "rear": "27.2"
        },
        "pressure": "1015.15 hPa",
        "temperature": "20.1°C"
    },
    {
        "timestamp": "2023-08-25T10:12:00Z",
        "gps": {
            "distance_from_beach": "26m",
            "latitude": "6.031594",
            "longitude": "80.237860",
            "speed": "0.35"
        },
        "accelerometer": {
            "x": "0.22",
            "y": "9.73",
            "z": "0.32"
        },
        "gyroscope": {
            "pitch": "0.7",
            "roll": "0.4",
            "yaw": "0.3"
        },
        "force": {
            "front": "22.0",
            "middle": "42.0",
            "rear": "27.0"
        },
        "pressure": "1015.1 hPa",
        "temperature": "20.2°C"
    },
    {
        "timestamp": "2023-08-25T10:13:00Z",
        "gps": {
            "distance_from_beach": "24m",
            "latitude": "6.03153",
            "longitude": "80.237873",
            "speed": "0.36"
        },
        "accelerometer": {
            "x": "0.23",
            "y": "9.72",
            "z": "0.33"
        },
        "gyroscope": {
            "pitch": "0.68",
            "roll": "0.42",
            "yaw": "0.32"
        },
        "force": {
            "front": "21.8",
            "middle": "41.8",
            "rear": "26.8"
        },
        "pressure": "1015.05 hPa",
        "temperature": "20.3°C"
    },
    {
        "timestamp": "2023-08-25T10:14:00Z",
        "gps": {
            "distance_from_beach": "22m",
            "latitude": "6.031466",
            "longitude": "80.237886",
            "speed": "0.37"
        },
        "accelerometer": {
            "x": "0.24",
            "y": "9.71",
            "z": "0.34"
        },
        "gyroscope": {
            "pitch": "0.65",
            "roll": "0.44",
            "yaw": "0.35"
        },
        "force": {
            "front": "21.6",
            "middle": "41.6",
            "rear": "26.6"
        },
        "pressure": "1015.0 hPa",
        "temperature": "20.4°C"
    }


]
var interval;
var interval2;
function plotData(simulationData) {


    var panel = document.querySelector(".surfboard");
    function updatePanelTransform(rotateX, rotateY, rotateZ) {
        panel.setAttribute("style", "transform: rotateX( " + rotateX + "deg ) rotateY( " + rotateY + "deg ) rotateZ( " + rotateZ + "deg )");
    }


    // loop simulationData with 1 second delay
    var i = 0;
    interval2 = setInterval(function () {
        if (i < simulationData.length) {
            var data = simulationData[i];
            var gps = data.gps;
            var accelerometer = data.accelerometer;
            var gyroscope = data.gyroscope;
            console.log(gyroscope);
            var force = data.force;

            // update panel
            updatePanelTransform(gyroscope.pitch * 15, gyroscope.roll * 15, gyroscope.yaw * 15);

            // // update gps
            var gpsElement = document.querySelector(".gps");
            gpsElement.querySelector(".latitude").innerHTML = "Lat :" + gps.latitude;
            gpsElement.querySelector(".longitude").innerHTML = "Long :" + gps.longitude;
            gpsElement.querySelector(".speed").innerHTML = "Speed :" + gps.speed;

            // // update accelerometer
            var accelerometerElement = document.querySelector(".accelerometer");
            accelerometerElement.querySelector(".x").innerHTML = "X :" + accelerometer.x;
            accelerometerElement.querySelector(".y").innerHTML = "Y :" + accelerometer.y;
            accelerometerElement.querySelector(".z").innerHTML = "Z :" + accelerometer.z;

            // // update force
            var forceElement = document.querySelector(".surfboard");
            forceElement.querySelector(".front").innerHTML = force.front;
            forceElement.querySelector(".middle").innerHTML = force.middle;
            forceElement.querySelector(".back").innerHTML = force.rear;

            //change color according to force distribution
            var front = force.front;
            var middle = force.middle;
            var back = force.rear;

            //find which part has the most force
            var max = Math.max(front, middle, back);
            // that part will be red
            if (max == front) {
                forceElement.querySelector(".front").style.backgroundColor = "red";
            } else if (max == middle) {
                forceElement.querySelector(".middle").style.backgroundColor = "red";
            } else {
                forceElement.querySelector(".back").style.backgroundColor = "red";
            }

            //find which part has the least force
            var min = Math.min(front, middle, back);
            // that part will be green
            if (min == front) {
                forceElement.querySelector(".front").style.backgroundColor = "green";
            } else if (min == middle) {
                forceElement.querySelector(".middle").style.backgroundColor = "green";
            } else {
                forceElement.querySelector(".back").style.backgroundColor = "green";
            }

            //find which part has the middle force
            var middle = Math.min(Math.max(front, middle), Math.max(Math.min(front, middle), back));
            // that part will be yellow
            if (middle == front) {
                forceElement.querySelector(".front").style.backgroundColor = "yellow";
            } else if (middle == middle) {
                forceElement.querySelector(".middle").style.backgroundColor = "yellow";
            } else {
                forceElement.querySelector(".back").style.backgroundColor = "yellow";
            }






            // // update temperature
            var temperatureElement = document.querySelector(".temperature");
            temperatureElement.querySelector(".value").innerHTML = data.temperature;

            // // update pressure
            var pressureElement = document.querySelector(".pressure");
            pressureElement.querySelector(".value").innerHTML = data.pressure;



            i++;
        } else {
            clearInterval(interval);
        }
    }, 2000);

}

function guideToSurf(endingPoint, CurrentPoint) {
    var lat1 = endingPoint.latitude;
    var lon1 = endingPoint.longitude;
    var lat2 = CurrentPoint.latitude;
    var lon2 = CurrentPoint.longitude;

    //If need to navigate to the ending point from the current point guide by the left,right,front,back,top,bottom



    var navigattionText = "";

    if (lat1 > lat2) {
        navigattionText += " back "
        // console.log(" back");
    } else {
        navigattionText += " front "

        // console.log(" front");
    }

    if (lon1 > lon2) {
        navigattionText += " right "
        // console.log(" right");
    }
    else {
        navigattionText += " left "
        // console.log(" left");
    }

    return navigattionText;


}


function generateMarkers(simulationData) {
    const latitudes = simulationData.map(function (data) { return data.gps.latitude; });
    const longitudes = simulationData.map(function (data) { return data.gps.longitude; });
    const timestamps = simulationData.map(function (data) { return data.timestamp; });
    const marker = initializeLeaflet();
    const navigattionTextElement = document.querySelector(".navigationText");
    // console.log(latitudes);
    var i = 0;
    interval = setInterval(function () {
        if (i < simulationData.length) {
            var data = simulationData[i];
            var gps = data.gps;
            // console.log(gps);
            marker.setLatLng([gps.latitude, gps.longitude]);
            let nText = guideToSurf({ latitude: 6.03159, longitude: 80.238 }, { latitude: gps.latitude, longitude: gps.longitude });
            navigattionTextElement.innerHTML = nText;
            i++;
        }
    }
        , 2000);

}

function initializeLeaflet() {
    var map = L.map('map').setView([6.032042, 80.237769], 13);

    //setzoom
    map.setZoom(18);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 80,
        attribution: '© OpenStreetMap'
    }).addTo(map);

    var marker;
    var lat = 6.032042;
    var long = 80.237769;
    marker = L.marker(
        [lat, long],
        {
            icon: new L.Icon({
                iconUrl: 'images/surfboard.png',

                iconSize: [30, 30],
                iconAnchor: [15, 30],
                popupAnchor: [0, -30]
            })
        }
    ).addTo(map);
    marker.bindPopup("Current Location.").openPopup();

    var optimumSurfCatchingPostion = L.marker([6.03159, 80.238]).addTo(map);
    //change popup position to bottom
    optimumSurfCatchingPostion.bindTooltip("Best Position to Catch Wave.", { direction: 'bottom' }).openTooltip();

    // optimumSurfCatchingPostion.bindPopup("Best Position to Catch Wave.").openPopup();


    return marker;
}



// plotGraph();
function startSimulation() {
    // initializeLeaflet();
    generateMarkers(guideSim);
    plotData(guideSim);
    console.log("Simulation started");
}



function stopSimulation() {
    console.log("Simulation stopped");
    clearInterval(interval);
}
